# 整体架构概述

> 本文档描述 AI Context Sync 框架的系统架构和文件组织方式。

---

## 系统架构

```
┌─────────────────────────────────────────────────────┐
│ docs/AI_CONTEXT/_RULES.md - AI 行为规则层（编辑器无关）│
│ - 定义 AI 何时读取文档                                 │
│ - 定义 AI 如何理解项目                                 │
│ - 定义遇到问题时的处理策略                              │
│ - 适用于任何 AI 编程助手                               │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ docs/AI_CONTEXT/MAP.md - 导航索引层                   │
│ - 项目概览（一句话描述 + 核心价值）                     │
│ - 模块职责（每个目录负责什么 + _AI_CONTEXT.md 路径）    │
│ - 关键路径（典型场景的执行流程）                        │
│ - 核心概念（领域模型）                                 │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ /<模块目录>/_AI_CONTEXT.md - 模块详情层（与代码共存）    │
│ - 模块职责范围                                        │
│ - 文件结构说明                                        │
│ - 关键接口文档                                        │
│ - 依赖关系图                                          │
│ - 使用示例和注意事项                                   │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ Subagent: doc-maintainer - AI 驱动的智能维护层         │
│ - 分析 git diff HEAD                                  │
│ - AI 理解变更语义（非规则匹配）                         │
│ - 基于自然语言规则判断影响范围                          │
│ - 增量更新文档                                        │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│ Git Hook (pre-commit) - 自动触发层                    │
│ - 提交前自动执行                                       │
│ - 调用 doc-maintainer                                 │
│ - 将文档更新包含在同一 commit                          │
└─────────────────────────────────────────────────────┘
```

---

## 文件分布示意

```
project-root/
├── docs/
│   └── AI_CONTEXT/
│       ├── _RULES.md          # AI 行为协议（原 CLAUDE.md）
│       └── MAP.md             # 项目导航索引
│
├── src/
│   ├── _AI_CONTEXT.md         # src 模块文档
│   ├── auth/
│   │   ├── _AI_CONTEXT.md     # auth 模块文档
│   │   ├── login.py
│   │   └── session.py
│   ├── payment/
│   │   ├── _AI_CONTEXT.md     # payment 模块文档
│   │   ├── processor.py
│   │   └── billing.py
│   └── utils/
│       ├── _AI_CONTEXT.md     # utils 模块文档
│       └── helpers.py
│
├── tests/
│   ├── _AI_CONTEXT.md         # tests 模块文档
│   └── test_auth.py
│
└── scripts/
    ├── _AI_CONTEXT.md         # scripts 模块文档
    ├── init_ai_context.py
    └── doc_maintainer.py
```

---

## 架构层级说明

### 第一层：AI 行为规则层
- **文件**: `docs/AI_CONTEXT/_RULES.md`
- **作用**: 定义 AI 在项目中的行为规范，适用于任何 AI 编程助手
- **核心内容**: 新对话启动流程、任务驱动的文档加载策略、异常处理

### 第二层：导航索引层
- **文件**: `docs/AI_CONTEXT/MAP.md`
- **作用**: 项目的"入口文档"，提供快速定位能力
- **核心内容**: 项目概览、模块职责、关键路径、核心概念

### 第三层：模块详情层
- **文件**: `/<模块>/_AI_CONTEXT.md`（与代码共存）
- **作用**: 为每个重要模块提供详细文档
- **核心内容**: 职责边界、内部结构、对外接口、依赖关系

### 第四层：智能维护层
- **组件**: doc-maintainer Subagent
- **作用**: AI 驱动的文档自动维护
- **核心能力**: 分析代码变更语义，智能判断文档更新需求

### 第五层：自动触发层
- **组件**: Git pre-commit Hook
- **作用**: 提交代码时自动触发文档维护
- **核心能力**: 检测代码变更，调用维护 Subagent，自动提交文档更新

---

## 相关文档

- **详细文档结构设计**: [002-初始化框架/002-文档层级设计.md](../002-初始化框架/002-文档层级设计.md)
- **维护机制详解**: [003-维护框架/002-doc-maintainer设计.md](../003-维护框架/002-doc-maintainer设计.md)
