# 自动化工具配置

> 本文档说明 AI Context 框架的自动化工具配置，包括生成规范、模板和质量标准。

---

## 预定义生成规范 (Skills / Rules)

在使用 Subagent 初始化之前，需要先建立标准化的生成规范：

```
┌───────────────────────────────────────────────────────────┐
│              预定义生成规范 (Skills / Rules)                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐   │
│  │ 文档结构模板 │  │ 内容生成规则 │  │ 质量检查标准    │   │
│  └─────────────┘  └─────────────┘  └─────────────────┘   │
└───────────────────────────────────────────────────────────┘
```

---

## 文档结构模板 (Skill: ai-context-generator)

### Skill 标准目录结构

```
skills/ai-context-generator/
├── SKILL.md              # 主文件：阐述 skill 的指令、用法和流程
├── assets/               # 可选：存放模板、配置等资源文件
│   ├── project-map-template.md
│   └── module-context-template.md
├── scripts/              # 可选：存放自动化脚本
│   └── validate-context.py
└── templates/            # 可选：存放生成模板
    └── section-templates.md
```

### SKILL.md 核心内容

```markdown
# AI Context Generator

## 描述
生成标准化的 _AI_CONTEXT.md 文档

## 触发条件
- 用户请求初始化 AI Context 框架
- 用户请求生成模块级上下文文档

## 执行流程
1. 分析目标目录结构
2. 根据模板生成文档
3. 填充自动生成的内容
4. 标记需要手动补充的部分

## 生成规范

### 项目级别模板 (MAP.md)
| 章节 | 必需 | 自动生成 | 说明 |
|------|------|----------|------|
| 快速定位 | ✅ | ❌ | 需要人工维护 |
| 项目概览 | ✅ | ✅ | 包含: description, core_value, tech_stack, scale |
| 模块职责 | ✅ | ✅ | 自动扫描目录生成 |
| 关键路径 | ✅ | ✅ | 分析代码流程生成 |
| 核心概念 | ✅ | ✅ | 提取领域术语 |
| 重要约定 | ❌ | ❌ | preserve_manual: 保留手动内容 |

### 模块级别模板 (_AI_CONTEXT.md)
| 章节 | 必需 | 自动生成 | 说明 |
|------|------|----------|------|
| 职责范围 | ✅ | ✅ | 一句话描述模块职责 |
| 文件结构 | ✅ | ✅ | 自动扫描生成 |
| 关键接口 | ✅ | ✅ | 提取公共接口 |
| 依赖关系 | ✅ | ✅ | 分析 import 语句 |
| 注意事项 | ❌ | ❌ | preserve_manual: 保留手动内容 |
```

---

## 内容生成规则

### 规则 1: 职责描述生成
- 职责描述应该是一句话，不超过 30 个字
- 使用动词开头，描述"做什么"而非"是什么"
- 避免使用模糊词汇（处理、管理）

**示例**：
- ✅ "验证用户身份并管理登录会话"
- ❌ "包含各种和用户登录相关的代码"

### 规则 2: 关键接口提取
- 只提取公共接口（exported / public）
- 按使用频率排序，最常用的放在前面
- 每个接口必须包含：用途、签名、位置、示例

**接口文档格式**：
```markdown
### function_name
- **用途**: [做什么]
- **签名**: `function(arg1: type, arg2: type) -> return_type`
- **位置**: file.py:行号
- **示例**:
  ```python
  result = function(arg1, arg2)
  ```

### 规则 3: 依赖关系分析
- 只记录直接依赖，不递归展开
- 区分"依赖"和"被依赖"
- 标注依赖的具体功能点

**依赖格式**：
``` markdown
**依赖的模块**:
- `/模块A` - 使用其 [功能]
- `/模块B` - 使用其 [功能]

**被依赖的模块**:
- `/模块C` - 调用本模块的 [接口]
```

### 规则 4: 路径分析
- 从入口点开始追踪
- 只记录主干流程，忽略异常分支
- 步骤数控制在 5-8 步

**路径格式**：
```markdown
### 路径: 用户登录流程
1. [用户提交凭证] → src/auth/login.py:authenticate()
2. [验证密码] → src/auth/password.py:verify()
3. [创建会话] → src/auth/session.py:create_session()
4. [返回 Token]
```

### 规则 5: 质量检查
- 所有 TODO 必须被填充或标记为可选
- 代码引用必须可验证（文件存在、行号有效）
- 概念定义必须与代码一致

---

## 质量检查标准

```yaml
# 质量检查清单
quality_checklist:
  completeness:
    - "所有 required sections 都已填充"
    - "没有遗留的 [TODO] 标记（除非明确标记为可选）"
    - "所有模块都有对应的 _AI_CONTEXT.md"
  
  accuracy:
    - "文件路径可验证（文件实际存在）"
    - "函数签名与代码一致"
    - "依赖关系与 import 语句一致"
  
  consistency:
    - "MAP.md 中的模块列表与实际目录一致"
    - "模块间引用使用相同的命名"
    - "术语定义在全项目保持一致"
```

### 质量指标

| 指标 | 成功标准 | 验证方法 |
|------|----------|----------|
| 文档完整性 | 核心文件全部存在 | 检查文件是否存在 |
| 内容准确性 | 关键信息准确率 > 90% | 人工抽检 |
| AI 理解度 | 基础问题正确率 100% | AI 测试提示词 |
| Hook 可用性 | 提交时正常触发 | 测试提交 |

---

## 配置文件模板

### .ai-context.yml

```yaml
# 文件路径: .ai-context.yml

# doc-maintainer 配置
doc_maintainer:
  # 是否启用自动维护
  enabled: true
  
  # 需要忽略的目录
  ignore_dirs:
    - node_modules
    - __pycache__
    - .git
    - dist
    - build
    - coverage
  
  # 需要忽略的文件模式
  ignore_patterns:
    - "*.min.js"
    - "*.map"
    - "*.lock"
  
  # 需要创建 _AI_CONTEXT.md 的最小文件数阈值
  min_files_for_context: 3
  
  # 日志级别
  log_level: info
```

---

## 技术约束

### 开发约束
- **Python 版本**: 3.6+（仅使用标准库）
- **跨平台**: macOS/Linux/Windows
- **性能**: Git hook 执行应在 5 秒内完成

### 文档约束
- **格式**: Markdown
- **大小**: MAP.md < 20KB，_AI_CONTEXT.md < 10KB
- **命名**: `_AI_CONTEXT.md`（下划线前缀，便于排序）

### Git 约束
- **非侵入**: 文档更新失败不应阻断 commit
- **原子性**: 文档更新应与代码变更在同一 commit
- **可选**: 可通过配置禁用自动更新

---

## 相关文档

- [初始化流程说明](./004-初始化流程说明.md)
- [Git-Hook 机制](../003-维护框架/001-Git-Hook机制.md)
- [doc-maintainer 设计](../003-维护框架/002-doc-maintainer设计.md)
