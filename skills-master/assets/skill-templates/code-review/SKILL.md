---
name: code-review
description: 代码评审检查技能。当用户告知"已完成本次需求，帮我检查代码"时触发。该技能会分析 git diff HEAD 的代码改动，结合业务需求文档检查代码修改的业务正确性，分析是否存在业务逻辑缺陷或实现错误，并提供详细的评审反馈和建议。
---

# 代码评审检查

当用户完成需求开发并请求代码检查时，执行以下评审流程。

## 评审流程

### 1. 获取代码改动

执行 `git diff HEAD` 命令获取本次所有代码改动内容：

```bash
git diff HEAD
```

如果改动较多，可以分文件查看：

```bash
git diff HEAD --stat  # 查看改动文件列表
git diff HEAD -- <file_path>  # 查看特定文件改动
```

### 2. 获取需求背景

查找 `.RequirementsAnalysis` 目录下最新的需求文档：

1. 列出目录内容，找到最新的需求目录
2. 读取需求文档，了解需求背景、需求内容和代码实施计划

### 3. 评审检查项

#### 3.1 业务正确性检查

- [ ] 代码改动是否符合需求文档中描述的业务逻辑
- [ ] 是否完整实现了所有需求点
- [ ] 边界条件是否处理正确
- [ ] 异常场景是否考虑周全

#### 3.2 代码质量检查

- [ ] 代码是否遵循项目现有的编码规范
- [ ] 是否存在潜在的 bug 或逻辑错误
- [ ] 错误处理是否恰当
- [ ] 是否有未使用的代码或冗余逻辑

#### 3.3 安全性检查

- [ ] 是否存在 SQL 注入、XSS 等安全漏洞
- [ ] 敏感数据是否正确处理
- [ ] 权限验证是否完善

#### 3.4 性能检查

- [ ] 是否存在性能瓶颈（如 N+1 查询、大循环等）
- [ ] 资源是否正确释放

### 4. 输出评审报告

按以下格式输出评审结果：

```markdown
## 代码评审报告

### 📋 需求对照

- 需求文档：<文档路径>
- 改动文件数：X 个
- 新增/删除行数：+X / -X

### ✅ 通过项

1. <通过的检查项及说明>

### ⚠️ 建议改进

1. **[文件名:行号]** <问题描述>
   - 建议：<改进建议>

### ❌ 必须修复

1. **[文件名:行号]** <问题描述>
   - 原因：<问题原因>
   - 建议：<修复方案>

### 📝 总结

<整体评价和建议>
```

## 注意事项

1. 评审时应结合项目上下文，不要机械式检查
2. 对于不确定的问题，应指出并建议进一步确认
3. 评审完成后等待用户反馈，必要时协助修复问题