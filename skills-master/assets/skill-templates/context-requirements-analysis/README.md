# AI Context Requirements Analysis Skill

## 简介

这是一个**规划导向**的技能，结合了 AI_CONTEXT 文档阅读与需求分析。它**不直接实施代码变更**，而是：

1. **阅读 AI_CONTEXT 文档**了解项目上下文
2. **创建需求分析文档**（使用标准需求分析工作流）
3. **规划文档更新**以便实施后保持同步

规划完成并经用户确认后，才开始实际实施。

---

## 工作流程

本技能采用完整的需求分析流程：

| 特性 | 基础分析 | 上下文感知分析 |
|-----|----------------------|----------------------------------|
| **定位** | 基础需求分析 | 上下文感知的智能需求分析 |
| **文档阅读** | ❌ 不读取项目文档 | ✅ 读取 AI_CONTEXT 文档 |
| **需求文档** | 基础结构 | **增强结构**（含 AI_CONTEXT 洞察） |
| **文档更新** | ❌ 不更新项目文档 | ✅ 规划并执行文档更新 |
| **工作流程** | 6 步 | 9 步（增加读取和更新阶段） |

### 工作流对比

```
基础分析:
  创建文件夹 → 更新 gitignore → 创建目录 → 创建文档 → 用户确认 → 实施

上下文感知分析:
  读取 AI 文档 → 创建文件夹 → 更新 gitignore → 创建目录 → 创建增强文档 → 用户确认 → 实施 → 更新 AI 文档 → 完成报告
```

---

## 核心工作流程

```
用户请求
    │
    ├─ 新 AI 会话? → 读取入门文档 → 询问具体需求
    │
    └─ 开发任务? → [Step 1] 读取 AI_CONTEXT 文档
                        │
                        ↓
                   [Step 2] 识别场景类型（功能/Bug/重构）
                        │
                        ↓
                   [Step 3] 创建需求分析文档
                        │
                        ↓
                   [Step 4] 用户确认
                        │
                        ↓
                   [Step 5] 实施开发
                        │
                        ↓
                   [Step 6] 更新 AI_CONTEXT 文档
                        │
                        ↓
                   [Step 7] 完成报告
```

---

## 使用场景

### 场景 1：新 AI 会话开始

**触发**: 用户开始新对话或询问项目概况

**流程**:
1. 读取 `QUICK_START.md`、`MAP.md`、`_RULES.md`
2. 向用户汇报项目概览
3. 询问具体需求
4. 如果用户提供开发任务 → 进入开发工作流

**不需要创建需求文档**

---

### 场景 2：开发新功能

**触发**: 用户请求添加新功能

**流程**:
1. **读取文档**: FEATURE_INDEX.md → DATA_MODEL.md → BUSINESS_FLOWS.md → DEVELOPMENT_GUIDE.md
2. **创建需求文档**: 包含 AI_CONTEXT 洞察的增强版需求文档
3. **用户确认**: 等待明确确认
4. **实施**: 按计划执行
5. **更新文档**: FEATURE_INDEX.md（必须）+ 其他相关文档

---

### 场景 3：修复 Bug

**触发**: 用户报告 Bug 或功能异常

**流程**:
1. **读取文档**: FEATURE_INDEX.md → BUSINESS_FLOWS.md → DATA_MODEL.md
2. **创建需求文档**: 包含根因分析和修复方案
3. **用户确认**: 等待明确确认
4. **实施**: 按计划修复
5. **更新文档**: BUSINESS_FLOWS.md（如发现边界情况）

---

### 场景 4：重构代码

**触发**: 用户请求代码重构或优化

**流程**:
1. **读取文档**: CORE_ARCHITECTURE.md → CONSTITUTION.md → DEVELOPMENT_GUIDE.md → DATA_MODEL.md
2. **创建需求文档**: 包含重构方案对比和影响分析
3. **用户确认**: 等待明确确认
4. **实施**: 按计划重构
5. **更新文档**: CONSTITUTION.md（必须，记录重构决策）+ 其他相关文档

---

## 增强版需求文档结构

本技能创建的需求文档比基础版多了以下内容：

```markdown
# {需求名称}

## 需求背景

{基于 AI_CONTEXT 文档的项目洞察:}
- 项目背景（来自 QUICK_START.md 和 MAP.md）
- 现有相关功能（来自 FEATURE_INDEX.md）
- 相关业务流程（来自 BUSINESS_FLOWS.md）
- 数据模型约束（来自 DATA_MODEL.md）

## 需求内容

{详细需求描述}

### 功能点清单

- [ ] 功能点 1
- [ ] 功能点 2

## 代码实施计划

{基于 AI_CONTEXT 文档的实施规划:}
- 涉及的模块（参考 CORE_ARCHITECTURE.md）
- 遵循的开发规范（参考 DEVELOPMENT_GUIDE.md）
- 可能的影响范围

### 改动文件清单

| 文件路径 | 改动类型 | 改动说明 | 参考文档 |
|---------|---------|---------|---------|
| path/to/file | 新增/修改 | 说明 | AI_CONTEXT 参考 |

### 实施步骤

1. 步骤 1
2. 步骤 2

## AI_CONTEXT 文档更新计划    ← 新增部分

{实施完成后需要更新的文档:}

| 文档 | 更新内容 | 优先级 |
|-----|---------|-------|
| FEATURE_INDEX.md | 添加新功能索引 | 🔴 高 |
| DATA_MODEL.md | 更新数据结构 | 🟡 中 |
```

---

## 文档更新规则

### 更新优先级

| 优先级 | 文档 | 更新时机 |
|-------|------|---------|
| 🔴 最高 | FEATURE_INDEX.md | 添加功能时必须更新 |
| 🟡 高 | DATA_MODEL.md, BUSINESS_FLOWS.md | 数据/流程变更时更新 |
| 🟢 中 | CORE_ARCHITECTURE.md, CONSTITUTION.md | 架构重构时更新 |
| 🟦 低 | DEVELOPMENT_GUIDE.md | 发现新最佳实践时更新 |

### 各场景更新要求

| 场景 | 必须更新 | 可能更新 |
|-----|---------|---------|
| 功能开发 | FEATURE_INDEX.md | DATA_MODEL.md, BUSINESS_FLOWS.md |
| Bug 修复 | - | BUSINESS_FLOWS.md, _RULES.md |
| 代码重构 | CONSTITUTION.md | CORE_ARCHITECTURE.md, FEATURE_INDEX.md |

---

## 使用示例

### 示例 1：添加用户头像功能

```
用户: "添加一个用户头像上传功能"

AI 执行流程:
1. [读取文档]
   - ✅ 读取 FEATURE_INDEX.md（检查是否已有类似功能）
   - ✅ 读取 DATA_MODEL.md（理解 UserProfile 数据结构）
   - ✅ 读取 BUSINESS_FLOWS.md（了解用户相关流程）
   - ✅ 读取 DEVELOPMENT_GUIDE.md（了解组件规范）

2. [创建需求文档]
   - 位置: .requirementsAnalysis/001-avatar-upload/requirements.md
   - 内容: 包含项目洞察的增强版需求文档

3. [用户确认]
   📝 需求分析文档已创建
   
   请确认：
   - 需求背景是否准确？
   - 功能点是否完整？
   - 实施计划是否合理？
   - 文档更新计划是否遗漏？

4. [等待用户确认...]

5. [实施] （用户确认后）

6. [更新文档]
   - ✅ 更新 FEATURE_INDEX.md
   - ✅ 更新 DATA_MODEL.md（新增 avatarUrl 字段）

7. [完成报告]
```

### 示例 2：修复同步 Bug

```
用户: "登录后同步数据失败"

AI 执行流程:
1. [读取文档]
   - ✅ 读取 FEATURE_INDEX.md（定位同步相关代码）
   - ✅ 读取 BUSINESS_FLOWS.md（理解同步流程）
   - ✅ 读取 DATA_MODEL.md（检查数据结构）

2. [创建需求文档]
   - 位置: .requirementsAnalysis/002-fix-sync-bug/requirements.md
   - 内容: 包含根因分析和修复方案

3. [用户确认]

4. [等待用户确认...]

5. [实施] （用户确认后）

6. [更新文档]
   - ✅ 更新 BUSINESS_FLOWS.md（补充边界情况）

7. [完成报告]
```

---

## 最佳实践

### 1. 先读文档再规划
❌ **错误**: 不读 AI_CONTEXT 直接创建需求文档  
✅ **正确**: 先读取相关文档，理解项目上下文后再规划

### 2. 需求文档要包含 AI_CONTEXT 洞察
❌ **错误**: 创建通用的需求文档  
✅ **正确**: 需求文档中明确引用 AI_CONTEXT 文档的发现

### 3. 提前规划文档更新
❌ **错误**: 等到最后才想文档更新  
✅ **正确**: 在需求文档中包含"AI_CONTEXT 文档更新计划"

### 4. 等待用户确认
❌ **错误**: 不等确认就开始实施  
✅ **正确**: 始终等待用户明确确认后才开始实施

### 5. 实时跟踪进度
❌ **错误**: 不更新进度  
✅ **正确**: 完成一个功能点就在需求文档中勾选

---

## 技能结构

```
ai_context_requirements-analysis/
├── SKILL.md                        # 技能定义（核心逻辑）
├── README.md                       # 本文档
└── references/
    └── document_mapping.md         # 文档映射指南
```

---

## 注意事项

⚠️ **重要提醒**:

1. **这是规划技能，不是实施技能** - 重点在于创建好的计划，而不是直接开始编码
2. **必须等待用户确认** - 不要假设用户已确认，等待明确回复
3. **需求文档是核心产出** - 需求文档应该详细到可以作为代码评审参考
4. **文档更新是完成标志** - 只有更新完 AI_CONTEXT 文档才算真正完成

---

## 版本信息

- **版本**: 1.1.0
- **创建日期**: 2026-02-05
- **更新日期**: 2026-02-05
- **基于**: AI Context Sync + 标准需求分析流程
- **适用项目**: Promptify (promptify-monorepo)

---

> 📅 更新日期：2026-02-05  
> 🎯 用途：上下文感知的智能需求规划  
> 🔄 关键区别：规划导向，非实施导向
